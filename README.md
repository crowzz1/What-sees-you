# What Sees You - 交互式 AI 视觉追踪艺术装置

这是一个基于计算机视觉和深度学习的交互式艺术装置核心程序。它模仿"注视"的行为，实时捕捉并分析观众的特征，通过机械臂的物理运动和屏幕上的视觉反馈与观众建立连接。

## 📸 项目概览

程序通过摄像头实时捕捉画面，利用先进的 AI 模型分析人物的**情绪**、**体型**和**衣着颜色**，并通过机械臂进行实时物理追踪。同时，系统会生成故障艺术（Glitch Art）视觉效果，并通过 OSC 协议将分析数据发送给外部程序（如 TouchDesigner）进行音视频互动。

### 核心功能

1.  **多维人物分析**
    *   **情绪识别**: 使用 HSEmotion (EfficientNet) 识别 7 种微表情 (Neutral, Happiness, Surprise, Sadness, Fear, Anger, Disgust/Contempt)。
    *   **颜色识别**: 基于 HSV 颜色空间和 K-Means 聚类的衣着颜色分析，智能剔除背景干扰，支持 12 种颜色分类。
    *   **体型判断**: 基于骨架关键点的体型估算 (Slim, Average, Broad)。

2.  **智能追踪系统**
    *   通过 STS 串行总线舵机驱动 4 轴机械臂。
    *   实现平滑的运动控制和目标锁定，模拟生物般的注视感。

3.  **画廊视图 (Gallery View)**
    *   **左上**: 原始分析视图（包含骨架、面部框、关键点）。
    *   **右上**: 实时故障艺术效果 (Glitch Art)，随情绪强度变化。
    *   **左下**: 人物画像与详细数据（剪影、情绪文本、颜色标签）。
    *   **右下**: 追踪器状态监控与调试信息。

4.  **OSC 通讯**
    *   实时发送分析结果到本地网络端口（默认 9000）。
    *   数据经过平滑处理，便于驱动生成艺术或灯光效果。

## 🛠️ 硬件要求

*   **PC**: 推荐配备 NVIDIA 显卡 (RTX 3060 及以上) 以获得最佳性能。
*   **摄像头**: 支持 USB 连接的摄像头 (推荐 1080p)。
*   **机械臂**: 搭载 STS3215/3032 串行总线舵机的 4 自由度机械臂。
*   **连接**: USB 连接至 Waveshare ST/SC 串行总线舵机驱动板 (USB 转 TTL)。

## 🚀 安装与配置

### 1. 环境安装

建议使用 Conda 创建 Python 3.10 或 3.11 环境：

```bash
conda create -n seesyou python=3.10
conda activate seesyou
```

安装项目依赖：

```bash
pip install -r requirements.txt
```

### 2. 硬件连接

1.  将摄像头插入电脑 USB 3.0 接口。
2.  将机械臂的 USB 转 TTL 模块插入电脑。
3.  打开 Windows **设备管理器** -> **端口 (COM 和 LPT)**，确认机械臂的 COM 端口号 (例如 `COM4`)。

### 3. 配置文件 (`config.py`)

打开根目录下的 `config.py` 文件，根据你的硬件情况修改以下配置：

```python
# ============================================================
# 硬件配置
# ============================================================

# 机械臂驱动板串口端口
# 根据设备管理器中的显示修改，例如 'COM3' 或 'COM4'
ARM_PORT = 'COM4'

# 摄像头设备ID (0 通常为默认/内置摄像头，1 为外接)
CAMERA_ID = 0

# 摄像头分辨率
CAMERA_WIDTH = 1920
CAMERA_HEIGHT = 1080
```

## 🎮 使用指南

### 启动程序

在终端中运行：

```bash
python main.py
```

程序启动后，会自动初始化摄像头、加载 AI 模型并尝试连接机械臂。

### 快捷键操作

*   `q`: 退出程序 (会自动复位机械臂并关闭 OSC 通道)。

## 📡 OSC 通讯协议

程序默认向 `127.0.0.1:9000` 发送 OSC 数据。
所有浮点数值范围为 `0.0` (无) 到 `1.0` (最大)，数值变化带有平滑过渡。

| OSC 地址 | 触发条件 | 说明 |
| :--- | :--- | :--- |
| `/Bg` | 程序运行状态 | 运行时为 1.0，关闭时为 0.0 |
| `/Neutral_Green_Cyan` | 平静 / 绿 / 青 | 检测到中性情绪，或衣着为绿色/青色 |
| `/Happiness_Yellow_Orange` | 快乐 / 黄 / 橙 | 检测到快乐情绪，或衣着为黄色/橙色 |
| `/Surprise_White_Pink` | 惊讶 / 白 / 粉 | 检测到惊讶情绪，或衣着为白色/粉色 |
| `/Sadness_Blue_Purple` | 悲伤 / 蓝 / 紫 | 检测到悲伤情绪，或衣着为蓝色/紫色 |
| `/Fear_Black` | 恐惧 / 黑 | 检测到恐惧情绪，或衣着为黑色 |
| `/Anger_Red` | 愤怒 / 红 | 检测到愤怒情绪，或衣着为红色 |
| `/Disgust_Contempt_Gray` | 厌恶 / 灰 | 检测到厌恶/轻蔑情绪，或衣着为灰色 |
| `/Slim` | 体型: 偏瘦 | 识别为 Slim 体型 |
| `/Average` | 体型: 适中 | 识别为 Average 体型 |
| `/Broad` | 体型: 宽/壮 | 识别为 Broad/Stocky/Athletic 体型 |

## ❓ 常见问题排查

**Q: 启动时报错 `could not open port`**
A: 检查 USB 线是否插好，并确认 `config.py` 中的 `ARM_PORT` 与设备管理器中一致。

**Q: 画面卡顿或 FPS 低**
A: 确保你已安装 CUDA 版本的 `torch` 和 `onnxruntime-gpu`。如果显卡性能较弱，可以在 `config.py` 中降低分辨率 (如 `640x480`)。

**Q: 颜色识别不准确**
A: 颜色识别受环境光影响较大。请确保场景光照充足且均匀。程序会自动尝试剔除背景，但如果背景颜色与人物衣着过于接近，可能会产生误判。

**Q: 机械臂不动作**
A: 检查机械臂电源是否接通。确认 `config.py` 中的 `ARM_BAUDRATE` 为 `1000000` (默认)。

---
**What Sees You** Project
